<html>

<head>
    <title>MyWealthPlan</title>
    <link rel="stylesheet" type="text/css" href="form2.css">
    <script src='https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js'></script>
</head>

<body>


    <div id="heading">
        <div class="title">
            <h1>Contact Request Form</h1>
        </div>

        <div class="form-signin">
            <h2 class="form-signin-heading">Please Enter Your Information</h2>
            <div class="input-container ic1">
                <p>
                    First Name:
                    <input type="text" class="form-control" size="35" id="FirstName" name="FirstName" placeholder=""
                        required="" autofocus="" />
                </p>
            </div>
            <br />
            <div class="input-container ic2">
                <p>
                    Last Name:
                    <input type="text" class="form-control" size="35" id="LastName" name="LastName" placeholder=""
                        required="" autofocus="" />
                </p>
            </div>
            <br />
            <div class="input-container ic2">
                <p>
                    E-mail Address:
                    <input type="text" class="form-control" size="35" id="EMail" name="EMail" placeholder="" required=""
                        autofocus="" />
                </p>
            </div>
            <br />
            <div class="input-container ic2">
                <p>
                    Desired Portfolio:
                    <select type="text" class="form-control" id="Portfolio" name="Portfolio" placeholder=""
                        autofocus="">
                        <option>Conservative</option>
                        <option>Balanced</option>
                        <option>Growth</option>
                        <option>Aggressive</option>
                        <option>Alternative</option>
                    </select>
                </p>
            </div>
            <br />
            <br />


            <button class="btn btn-lg btn-primary btn-block" onclick="formSubmit();">Save</button>
        </div>


    </div>
    <script type="text/javascript">

        async function loadWeb3() {
            if (window.ethereum) {
                window.web3 = new Web3(window.ethereum);
                await window.ethereum.enable();
                const accounts = await window.web3.eth.getAccounts();
                window.currentAccount = accounts[0]
            }
        }

        async function loadContract() {
            // set ABI
            var abi = [
                {
                    "constant": false,
                    "inputs": [
                        {
                            "internalType": "address payable",
                            "name": "_userAddress",
                            "type": "address"
                        },
                        {
                            "internalType": "uint256",
                            "name": "_amount",
                            "type": "uint256"
                        }
                    ],
                    "name": "approveWithdrawal",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "anonymous": false,
                    "inputs": [
                        {
                            "indexed": true,
                            "internalType": "address",
                            "name": "userAddress",
                            "type": "address"
                        },
                        {
                            "indexed": false,
                            "internalType": "uint256",
                            "name": "amount",
                            "type": "uint256"
                        }
                    ],
                    "name": "CompanyWithdrawal",
                    "type": "event"
                },
                {
                    "constant": false,
                    "inputs": [],
                    "name": "deposit",
                    "outputs": [],
                    "payable": true,
                    "stateMutability": "payable",
                    "type": "function"
                },
                {
                    "anonymous": false,
                    "inputs": [
                        {
                            "indexed": true,
                            "internalType": "address",
                            "name": "userAddress",
                            "type": "address"
                        },
                        {
                            "indexed": false,
                            "internalType": "uint256",
                            "name": "amount",
                            "type": "uint256"
                        }
                    ],
                    "name": "Deposit",
                    "type": "event"
                },
                {
                    "constant": false,
                    "inputs": [
                        {
                            "internalType": "string",
                            "name": "f_name",
                            "type": "string"
                        },
                        {
                            "internalType": "string",
                            "name": "l_name",
                            "type": "string"
                        },
                        {
                            "internalType": "string",
                            "name": "email",
                            "type": "string"
                        },
                        {
                            "internalType": "string",
                            "name": "portfolio",
                            "type": "string"
                        }
                    ],
                    "name": "insertUpdateUser",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "constant": false,
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "userAddress",
                            "type": "address"
                        },
                        {
                            "internalType": "string",
                            "name": "f_name",
                            "type": "string"
                        },
                        {
                            "internalType": "string",
                            "name": "l_name",
                            "type": "string"
                        },
                        {
                            "internalType": "string",
                            "name": "email",
                            "type": "string"
                        },
                        {
                            "internalType": "string",
                            "name": "portfolio",
                            "type": "string"
                        },
                        {
                            "internalType": "uint256",
                            "name": "balance",
                            "type": "uint256"
                        }
                    ],
                    "name": "insertUser",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "anonymous": false,
                    "inputs": [
                        {
                            "indexed": true,
                            "internalType": "address",
                            "name": "userAddress",
                            "type": "address"
                        },
                        {
                            "indexed": false,
                            "internalType": "uint256",
                            "name": "index",
                            "type": "uint256"
                        },
                        {
                            "indexed": false,
                            "internalType": "string",
                            "name": "f_name",
                            "type": "string"
                        },
                        {
                            "indexed": false,
                            "internalType": "string",
                            "name": "l_name",
                            "type": "string"
                        },
                        {
                            "indexed": false,
                            "internalType": "string",
                            "name": "email",
                            "type": "string"
                        },
                        {
                            "indexed": false,
                            "internalType": "string",
                            "name": "portfolio",
                            "type": "string"
                        },
                        {
                            "indexed": false,
                            "internalType": "uint256",
                            "name": "balance",
                            "type": "uint256"
                        }
                    ],
                    "name": "LogNewUser",
                    "type": "event"
                },
                {
                    "anonymous": false,
                    "inputs": [
                        {
                            "indexed": true,
                            "internalType": "address",
                            "name": "userAddress",
                            "type": "address"
                        },
                        {
                            "indexed": false,
                            "internalType": "uint256",
                            "name": "index",
                            "type": "uint256"
                        },
                        {
                            "indexed": false,
                            "internalType": "string",
                            "name": "f_name",
                            "type": "string"
                        },
                        {
                            "indexed": false,
                            "internalType": "string",
                            "name": "l_name",
                            "type": "string"
                        },
                        {
                            "indexed": false,
                            "internalType": "string",
                            "name": "email",
                            "type": "string"
                        },
                        {
                            "indexed": false,
                            "internalType": "string",
                            "name": "portfolio",
                            "type": "string"
                        },
                        {
                            "indexed": false,
                            "internalType": "uint256",
                            "name": "balance",
                            "type": "uint256"
                        }
                    ],
                    "name": "LogUpdateUser",
                    "type": "event"
                },
                {
                    "constant": false,
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "userAddress",
                            "type": "address"
                        }
                    ],
                    "name": "registerClient",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "anonymous": false,
                    "inputs": [
                        {
                            "indexed": true,
                            "internalType": "address",
                            "name": "userAddress",
                            "type": "address"
                        },
                        {
                            "indexed": false,
                            "internalType": "uint256",
                            "name": "index",
                            "type": "uint256"
                        },
                        {
                            "indexed": false,
                            "internalType": "uint256",
                            "name": "balance",
                            "type": "uint256"
                        }
                    ],
                    "name": "RegisterClient",
                    "type": "event"
                },
                {
                    "constant": false,
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "_amount",
                            "type": "uint256"
                        }
                    ],
                    "name": "requestWithdrawal",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "constant": false,
                    "inputs": [
                        {
                            "internalType": "address payable",
                            "name": "_userAddress",
                            "type": "address"
                        },
                        {
                            "internalType": "uint256",
                            "name": "_amount",
                            "type": "uint256"
                        }
                    ],
                    "name": "sendMoneyToClient",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "constant": false,
                    "inputs": [
                        {
                            "internalType": "address payable",
                            "name": "_companyAccount",
                            "type": "address"
                        }
                    ],
                    "name": "setCompanyAccount",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "constant": false,
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "userAddress",
                            "type": "address"
                        },
                        {
                            "internalType": "string",
                            "name": "email",
                            "type": "string"
                        }
                    ],
                    "name": "updateUserEmail",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "anonymous": false,
                    "inputs": [
                        {
                            "indexed": true,
                            "internalType": "address",
                            "name": "userAddress",
                            "type": "address"
                        },
                        {
                            "indexed": false,
                            "internalType": "uint256",
                            "name": "amount",
                            "type": "uint256"
                        }
                    ],
                    "name": "Withdrawal",
                    "type": "event"
                },
                {
                    "anonymous": false,
                    "inputs": [
                        {
                            "indexed": true,
                            "internalType": "address",
                            "name": "userAddress",
                            "type": "address"
                        },
                        {
                            "indexed": false,
                            "internalType": "uint256",
                            "name": "amount",
                            "type": "uint256"
                        }
                    ],
                    "name": "WithdrawalRequest",
                    "type": "event"
                },
                {
                    "constant": true,
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "_userAddress",
                            "type": "address"
                        }
                    ],
                    "name": "getClientBalance",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "constant": true,
                    "inputs": [],
                    "name": "getCompanyBalance",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "constant": true,
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "userAddress",
                            "type": "address"
                        }
                    ],
                    "name": "getUser",
                    "outputs": [
                        {
                            "internalType": "string",
                            "name": "f_name",
                            "type": "string"
                        },
                        {
                            "internalType": "string",
                            "name": "l_name",
                            "type": "string"
                        },
                        {
                            "internalType": "string",
                            "name": "email",
                            "type": "string"
                        },
                        {
                            "internalType": "string",
                            "name": "portfolio",
                            "type": "string"
                        },
                        {
                            "internalType": "uint256",
                            "name": "balance",
                            "type": "uint256"
                        },
                        {
                            "internalType": "uint256",
                            "name": "index",
                            "type": "uint256"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "constant": true,
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "index",
                            "type": "uint256"
                        }
                    ],
                    "name": "getUserAtIndex",
                    "outputs": [
                        {
                            "internalType": "address",
                            "name": "userAddress",
                            "type": "address"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "constant": true,
                    "inputs": [],
                    "name": "getUserBalance",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "constant": true,
                    "inputs": [],
                    "name": "getUserCount",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "count",
                            "type": "uint256"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "constant": true,
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "userAddress",
                            "type": "address"
                        }
                    ],
                    "name": "isUser",
                    "outputs": [
                        {
                            "internalType": "bool",
                            "name": "isIndeed",
                            "type": "bool"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                }
            ]
            //set contract address
            var contractAddress = '0xe3D51A33dAaD01290fe7f8fc2cF49C6C638e0B56';

            return await new window.web3.eth.Contract(abi, contractAddress);
        }

        async function insertUpdateUser() {
            const contract = await loadContract()
            await contract.methods
                .insertUpdateUser(
                    document.getElementById("FirstName").value,
                    document.getElementById("LastName").value,
                    document.getElementById("EMail").value,
                    document.getElementById("Portfolio").value,


                )
                .send({ from: window.currentAccount })
                .then(function (receipt) { console.log });
            ;

            window.location.href = "confirmation.html";


        }

        function formSubmit() {
            validateForm();

            insertUpdateUser();





        }




        function validateForm() {
            var f_name =
                document.getElementById("FirstName").value;
            var l_name =
                document.getElementById("LastName").value;
            var email =
                document.getElementById("EMail").value;
            var port =
                document.getElementById("Portfolio").value;

            //Javascript reGex for Email Validation.
            var regEmail = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/g;
            // Javascript reGex for Phone Number validation.
            var regPhone = /^\d{10}$/;
            // Javascript reGex for Name validation
            var regName = /\d+$/g;

            if (f_name == "" || regName.test(f_name)) {
                window.alert("Please enter your first name");
                f_name.focus();
                return false;
            }

            if (l_name == "" || regName.test(l_name)) {
                window.alert("Please enter your last name");
                l_name.focus();
                return false;
            }


            if (email == "" || !regEmail.test(email)) {
                window.alert("Please enter a valid e-mail address.");
                email.focus();
                return false;
            }

            if (port.selectedIndex == -1) {
                window.alert("Please enter your portfolio choice.");
                port.focus();
                return false;
            }



        }


        async function load() {
            await loadWeb3();
            window.contract = await loadContract();
        }

        load();




    </script>
</body>

</html>
