<html>

<head>
    <title>MyWealthPlan</title>
    <link rel="stylesheet" type="text/css" href="form.css">
    <script src='https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js'></script>
</head>

<body>


    <div id="heading">
        <h1>Client Engagement Page</h1>
        Welcome to the MyWealthPlan Client Engagement Page. We are pleased to have you joint the ranks of our satisfied
        clients. Please complete the form below to begin the onboarding process. Rest assured we will not share or sell
        your
        information without your permission.

        After submitting your basic contact information you will be asked to submit a small deposit which will be used
        to
        create your account with us.
        <div class="form-signin">
            <h2 class="form-signin-heading">Please Enter Your Information</h2>


            <p>
                First Name:
                <input type="text" class="form-control" size="35" id="FirstName" name="FirstName" placeholder=""
                    required="" autofocus="" />
            </p>
            <br />
            <p>
                Last Name:
                <input type="text" class="form-control" size="35" id="LastName" name="LastName" placeholder=""
                    required="" autofocus="" />
            </p>
            <br />
            <p>
                E-mail Address:
                <input type="text" class="form-control" size="35" id="EMail" name="EMail" placeholder="" required=""
                    autofocus="" />
            </p>
            <br />

            <p>
                Desired Portfolio:
                <select type="text" class="form-control" id="Portfolio" name="Portfolio" placeholder="" autofocus="">
                    <option>Conservative</option>
                    <option>Balanced</option>
                    <option>Growth</option>
                    <option>Aggressive</option>
                    <option>Alternative</option>
                </select>
            </p>
            <br />
            <br />
            </form>

            <button class="btn btn-lg btn-primary btn-block" onclick="formSubmit();">Save</button>
        </div>

        <!--
   <div class="wrapper">
    <div class="form-signin">
      <h2 class="form-signin-heading">Please Click to See Your Saved Information</h2>
      <button class="btn btn-lg btn-primary btn-block"  onclick="retrive_information();">Show</button>

      </br>
       <div  id="id_1"></div>
       <div class="form-control" id="name_1"></div>
       <div class="form-control" id="last_name_1"></div>
       <div class="form-control" id="address_1"></div>
       <div class="form-control" id="mob_no_1"></div>
    </div>
  </div>
-->
    </div>
    <script type="text/javascript">

        async function loadWeb3() {
            if (window.ethereum) {
                window.web3 = new Web3(window.ethereum);
                await window.ethereum.enable();
                const accounts = await window.web3.eth.getAccounts();
                window.currentAccount = accounts[0]
            }
        }

        async function loadContract() {
            // set ABI
            var abi = [
                {
                    "anonymous": false,
                    "inputs": [
                        {
                            "indexed": true,
                            "internalType": "address",
                            "name": "userAddress",
                            "type": "address"
                        },
                        {
                            "indexed": false,
                            "internalType": "uint256",
                            "name": "index",
                            "type": "uint256"
                        },
                        {
                            "indexed": false,
                            "internalType": "string",
                            "name": "f_name",
                            "type": "string"
                        },
                        {
                            "indexed": false,
                            "internalType": "string",
                            "name": "l_name",
                            "type": "string"
                        },
                        {
                            "indexed": false,
                            "internalType": "string",
                            "name": "email",
                            "type": "string"
                        },
                        {
                            "indexed": false,
                            "internalType": "string",
                            "name": "portfolio",
                            "type": "string"
                        }
                    ],
                    "name": "LogNewUser",
                    "type": "event"
                },
                {
                    "anonymous": false,
                    "inputs": [
                        {
                            "indexed": true,
                            "internalType": "address",
                            "name": "userAddress",
                            "type": "address"
                        },
                        {
                            "indexed": false,
                            "internalType": "uint256",
                            "name": "index",
                            "type": "uint256"
                        },
                        {
                            "indexed": false,
                            "internalType": "string",
                            "name": "f_name",
                            "type": "string"
                        },
                        {
                            "indexed": false,
                            "internalType": "string",
                            "name": "l_name",
                            "type": "string"
                        },
                        {
                            "indexed": false,
                            "internalType": "string",
                            "name": "email",
                            "type": "string"
                        },
                        {
                            "indexed": false,
                            "internalType": "string",
                            "name": "portfolio",
                            "type": "string"
                        }
                    ],
                    "name": "LogUpdateUser",
                    "type": "event"
                },
                {
                    "constant": true,
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "userAddress",
                            "type": "address"
                        }
                    ],
                    "name": "getUser",
                    "outputs": [
                        {
                            "internalType": "string",
                            "name": "f_name",
                            "type": "string"
                        },
                        {
                            "internalType": "string",
                            "name": "l_name",
                            "type": "string"
                        },
                        {
                            "internalType": "string",
                            "name": "email",
                            "type": "string"
                        },
                        {
                            "internalType": "string",
                            "name": "portfolio",
                            "type": "string"
                        },
                        {
                            "internalType": "uint256",
                            "name": "index",
                            "type": "uint256"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "constant": true,
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "index",
                            "type": "uint256"
                        }
                    ],
                    "name": "getUserAtIndex",
                    "outputs": [
                        {
                            "internalType": "address",
                            "name": "userAddress",
                            "type": "address"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "constant": true,
                    "inputs": [],
                    "name": "getUserCount",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "count",
                            "type": "uint256"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "constant": false,
                    "inputs": [
                        {
                            "internalType": "string",
                            "name": "f_name",
                            "type": "string"
                        },
                        {
                            "internalType": "string",
                            "name": "l_name",
                            "type": "string"
                        },
                        {
                            "internalType": "string",
                            "name": "email",
                            "type": "string"
                        },
                        {
                            "internalType": "string",
                            "name": "portfolio",
                            "type": "string"
                        }
                    ],
                    "name": "insertUpdateUser",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "constant": false,
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "userAddress",
                            "type": "address"
                        },
                        {
                            "internalType": "string",
                            "name": "f_name",
                            "type": "string"
                        },
                        {
                            "internalType": "string",
                            "name": "l_name",
                            "type": "string"
                        },
                        {
                            "internalType": "string",
                            "name": "email",
                            "type": "string"
                        },
                        {
                            "internalType": "string",
                            "name": "portfolio",
                            "type": "string"
                        }
                    ],
                    "name": "insertUser",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "constant": true,
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "userAddress",
                            "type": "address"
                        }
                    ],
                    "name": "isUser",
                    "outputs": [
                        {
                            "internalType": "bool",
                            "name": "isIndeed",
                            "type": "bool"
                        }
                    ],
                    "payable": false,
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "constant": false,
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "userAddress",
                            "type": "address"
                        },
                        {
                            "internalType": "string",
                            "name": "email",
                            "type": "string"
                        }
                    ],
                    "name": "updateUserEmail",
                    "outputs": [],
                    "payable": false,
                    "stateMutability": "nonpayable",
                    "type": "function"
                }
            ]
            //set contract address
            var contractAddress = '0x0673d9B45d59F6effD422143D66cC1242Cb2526F';

            return await new window.web3.eth.Contract(abi, contractAddress);
        }

        async function insertUpdateUser() {
            const contract = await loadContract()
            await contract.methods
                .insertUpdateUser(
                    document.getElementById("FirstName").value,
                    document.getElementById("LastName").value,
                    document.getElementById("EMail").value,
                    document.getElementById("Portfolio").value,


                )
                .send({ from: window.currentAccount })
                .then(function (receipt) { console.log });
            ;
            window.alert("Thank You. Your information has been received and we will contact you in the near future.");
            //window.location.href = "deposit.html";


        }

        function formSubmit() {
            validateForm();
            window.alert("Thank You");
            insertUpdateUser();





        }




        function validateForm() {
            var f_name =
                document.getElementById("FirstName").value;
            var l_name =
                document.getElementById("LastName").value;
            var email =
                document.getElementById("EMail").value;
            var port =
                document.getElementById("Portfolio").value;

            //Javascript reGex for Email Validation.
            var regEmail = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/g;
            // Javascript reGex for Phone Number validation.
            var regPhone = /^\d{10}$/;
            // Javascript reGex for Name validation
            var regName = /\d+$/g;

            if (f_name == "" || regName.test(f_name)) {
                window.alert("Please enter your first name");
                f_name.focus();
                return false;
            }

            if (l_name == "" || regName.test(l_name)) {
                window.alert("Please enter your last name");
                l_name.focus();
                return false;
            }


            if (email == "" || !regEmail.test(email)) {
                window.alert("Please enter a valid e-mail address.");
                email.focus();
                return false;
            }

            if (port.selectedIndex == -1) {
                window.alert("Please enter your portfolio choice.");
                port.focus();
                return false;
            }



        }




        async function retrive_information() {
            const contract = await loadContract()
            await contract.methods.retrive_information().call({ from: window.currentAccount }).then(function (result) {
                document.getElementById("name_1").innerHTML = "Your First Name is : " + result[1];
                document.getElementById("last_name_1").innerHTML = "Your Last Name is : " + result[2];
                document.getElementById("email_1").innerHTML = "Your Email is : " + result[3];
                document.getElementById("phone_1").innerHTML = "Your Mobile No is : " + result[4];
            });
        }

        async function load() {
            await loadWeb3();
            window.contract = await loadContract();
        }

        load();




    </script>
</body>

</html>
